    def _create_users_tab(self):
        """Ø¥Ù†Ø´Ø§Ø¡ ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"""
        users_frame = tk.Frame(self.tab_control, bg=self.COLORS["background"])
        self.tab_control.add(users_frame, text="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†")

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        title_frame = tk.Frame(users_frame, bg=self.COLORS["surface"], padx=20, pady=15)
        title_frame.pack(fill=tk.X, pady=(0, 20))

        tk.Label(title_frame, text="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
                 font=self.FONTS["large_title"],
                 bg=self.COLORS["surface"],
                 fg=self.COLORS["dark"]).pack()

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        buttons_frame = tk.Frame(users_frame, bg=self.COLORS["background"])
        buttons_frame.pack(pady=20)

        open_users_btn = tk.Button(
            buttons_frame,
            text="ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
            font=self.FONTS["text_bold"],
            bg=self.COLORS["primary"],
            fg="white",
            padx=30, pady=15,
            bd=0, relief=tk.FLAT,
            cursor="hand2",
            command=self._open_user_management
        )
        open_users_btn.pack()

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        info_frame = tk.Frame(users_frame, bg=self.COLORS["surface"], padx=20, pady=20)
        info_frame.pack(fill=tk.X, padx=50, pady=20)

        info_text = """Ù…Ù† Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ:
        â€¢ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯ Ù„Ù„Ù†Ø¸Ø§Ù…
        â€¢ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
        â€¢ ØªÙØ¹ÙŠÙ„ Ø£Ùˆ ØªØ¹Ø·ÙŠÙ„ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        â€¢ Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        â€¢ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†"""

        tk.Label(info_frame, text=info_text,
                 font=self.FONTS["text"],
                 bg=self.COLORS["surface"],
                 fg=self.COLORS["dark"],
                 justify=tk.RIGHT).pack(pady=10)

    def _create_settings_tab(self):
        """Ø¥Ù†Ø´Ø§Ø¡ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨ØªØµÙ…ÙŠÙ… Ù…Ø­Ø³Ù†"""
        settings_frame = tk.Frame(self.tab_control, bg=self.COLORS["background"])
        self.tab_control.add(settings_frame, text="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª")

        # Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        header_frame = tk.Frame(settings_frame, bg="#1E3A5F", height=80)
        header_frame.pack(fill=tk.X, padx=10, pady=10)
        header_frame.pack_propagate(False)

        title_label = tk.Label(
            header_frame,
            text="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…",
            font=self.FONTS["large_title"],
            bg="#1E3A5F",
            fg="white"
        )
        title_label.pack(expand=True)

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        main_content = tk.Frame(settings_frame, bg=self.COLORS["background"])
        main_content.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

        # Ù‚Ø³Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        backup_section = tk.Frame(main_content, bg=self.COLORS["surface"], relief=tk.RIDGE, bd=2)
        backup_section.pack(fill=tk.X, pady=(0, 20))

        # Ø¹Ù†ÙˆØ§Ù† Ù‚Ø³Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        backup_header = tk.Frame(backup_section, bg="#2E7D32", height=50)
        backup_header.pack(fill=tk.X)
        backup_header.pack_propagate(False)

        tk.Label(
            backup_header,
            text="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©",
            font=("Tajawal", 18, "bold"),
            bg="#2E7D32",
            fg="white"
        ).pack(expand=True)

        # Ù…Ø­ØªÙˆÙ‰ Ù‚Ø³Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        backup_content = tk.Frame(backup_section, bg=self.COLORS["surface"], padx=30, pady=20)
        backup_content.pack(fill=tk.X)

        tk.Label(
            backup_content,
            text="Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…",
            font=("Tajawal", 14),
            bg=self.COLORS["surface"],
            fg="#666"
        ).pack(anchor=tk.W, pady=(0, 15))

        # Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        backup_buttons_frame = tk.Frame(backup_content, bg=self.COLORS["surface"])
        backup_buttons_frame.pack(fill=tk.X)

        # Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        create_backup_btn = tk.Button(
            backup_buttons_frame,
            text="ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©",
            font=("Tajawal", 14, "bold"),
            bg="#2E7D32",
            fg="white",
            padx=30,
            pady=12,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=self._create_automatic_backup
        )
        create_backup_btn.pack(side=tk.LEFT, padx=(0, 10))

        # ØªØ£Ø«ÙŠØ±Ø§Øª hover
        create_backup_btn.bind("<Enter>", lambda e: create_backup_btn.config(bg="#1B5E20"))
        create_backup_btn.bind("<Leave>", lambda e: create_backup_btn.config(bg="#2E7D32"))

        # Ø²Ø± Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        restore_backup_btn = tk.Button(
            backup_buttons_frame,
            text="ğŸ“‚ Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©",
            font=("Tajawal", 14, "bold"),
            bg="#1976D2",
            fg="white",
            padx=30,
            pady=12,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=self._browse_backups
        )
        restore_backup_btn.pack(side=tk.LEFT)

        # ØªØ£Ø«ÙŠØ±Ø§Øª hover
        restore_backup_btn.bind("<Enter>", lambda e: restore_backup_btn.config(bg="#0D47A1"))
        restore_backup_btn.bind("<Leave>", lambda e: restore_backup_btn.config(bg="#1976D2"))

        # Ø®Ø· ÙØ§ØµÙ„
        separator = tk.Frame(main_content, bg=self.COLORS["border"], height=2)
        separator.pack(fill=tk.X, pady=20)

        # Ù‚Ø³Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        reset_section = tk.Frame(main_content, bg=self.COLORS["surface"], relief=tk.RIDGE, bd=2)
        reset_section.pack(fill=tk.X)

        # Ø¹Ù†ÙˆØ§Ù† Ù‚Ø³Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        reset_header = tk.Frame(reset_section, bg="#D32F2F", height=50)
        reset_header.pack(fill=tk.X)
        reset_header.pack_propagate(False)

        tk.Label(
            reset_header,
            text="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…",
            font=("Tajawal", 18, "bold"),
            bg="#D32F2F",
            fg="white"
        ).pack(expand=True)

        # Ù…Ø­ØªÙˆÙ‰ Ù‚Ø³Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        reset_content = tk.Frame(reset_section, bg=self.COLORS["surface"], padx=30, pady=20)
        reset_content.pack(fill=tk.X)

        tk.Label(
            reset_content,
            text="âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹",
            font=("Tajawal", 14, "bold"),
            bg=self.COLORS["surface"],
            fg="#D32F2F"
        ).pack(anchor=tk.W, pady=(0, 15))

        # Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        reset_btn = tk.Button(
            reset_content,
            text="ğŸ—‘ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…",
            font=("Tajawal", 14, "bold"),
            bg="#D32F2F",
            fg="white",
            padx=30,
            pady=12,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=self._reset_system
        )
        reset_btn.pack()

        # ØªØ£Ø«ÙŠØ±Ø§Øª hover
        reset_btn.bind("<Enter>", lambda e: reset_btn.config(bg="#B71C1C"))
        reset_btn.bind("<Leave>", lambda e: reset_btn.config(bg="#D32F2F"))

    def _create_automatic_backup(self):
        """Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙÙŠ Ù…Ø¬Ù„Ø¯ Backup"""
        import shutil
        import os

        try:
            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Backup Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            backup_dir = os.path.join(os.path.dirname(os.path.abspath(__file__)), "Backup")
            if not os.path.exists(backup_dir):
                os.makedirs(backup_dir)

            # Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
            backup_filename = f"backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}.db"
            backup_path = os.path.join(backup_dir, backup_filename)

            # Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            self.db_conn.commit()

            # Ù†Ø³Ø® Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­
            shutil.copy2("training_system.db", backup_path)

            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            info_filename = f"backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}_info.txt"
            info_path = os.path.join(backup_dir, info_filename)

            with open(info_path, 'w', encoding='utf-8') as f:
                f.write("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©\n")
                f.write("=" * 40 + "\n")
                f.write(f"Ø§Ù„ØªØ§Ø±ÙŠØ®: {datetime.now().strftime('%Y-%m-%d')}\n")
                f.write(f"Ø§Ù„ÙˆÙ‚Øª: {datetime.now().strftime('%H:%M:%S')}\n")
                f.write(f"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {self.current_user['full_name'] if self.current_user else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n")
                f.write(f"Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: {os.path.getsize(backup_path) / (1024 * 1024):.2f} MB\n")

            # Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            backup_count = len([f for f in os.listdir(backup_dir) if f.endswith('.db')])

            messagebox.showinfo(
                "Ù†Ø¬Ø§Ø­",
                f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­\n\n"
                f"Ø§Ù„Ù…Ø³Ø§Ø±: Backup\\{backup_filename}\n"
                f"Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: {backup_count}"
            )

            # Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 10 Ù†Ø³Ø® ÙÙ‚Ø·)
            self._cleanup_old_backups(backup_dir, keep_count=10)

        except Exception as e:
            messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:\n{str(e)}")

    def _browse_backups(self):
        """Ø§Ø³ØªØ¹Ø±Ø§Ø¶ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ù…Ø¬Ù„Ø¯ Backup"""
        import os

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        backup_dir = os.path.join(os.path.dirname(os.path.abspath(__file__)), "Backup")
        if not os.path.exists(backup_dir):
            messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¬Ù„Ø¯ Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©")
            return

        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        backup_files = [f for f in os.listdir(backup_dir) if f.endswith('.db') and f.startswith('backup_')]

        if not backup_files:
            messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©")
            return

        # ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ø³Ø® Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
        backup_files.sort(reverse=True)

        # Ù†Ø§ÙØ°Ø© Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        browse_window = tk.Toplevel(self)
        browse_window.title("Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©")
        browse_window.geometry("600x500")
        browse_window.configure(bg=self.COLORS["background"])
        browse_window.transient(self)
        browse_window.grab_set()

        # ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©
        browse_window.update_idletasks()
        x = (browse_window.winfo_screenwidth() - 600) // 2
        y = (browse_window.winfo_screenheight() - 500) // 2
        browse_window.geometry(f"600x500+{x}+{y}")

        # Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        header_frame = tk.Frame(browse_window, bg="#1976D2", height=60)
        header_frame.pack(fill=tk.X)
        header_frame.pack_propagate(False)

        tk.Label(
            header_frame,
            text="Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©",
            font=("Tajawal", 18, "bold"),
            bg="#1976D2",
            fg="white"
        ).pack(expand=True)

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        list_frame = tk.Frame(browse_window, bg=self.COLORS["surface"], bd=2, relief=tk.RIDGE)
        list_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

        # Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
        scrollbar = tk.Scrollbar(list_frame)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø®
        listbox = tk.Listbox(
            list_frame,
            font=("Tajawal", 12),
            yscrollcommand=scrollbar.set,
            selectbackground="#1976D2",
            selectforeground="white",
            height=12
        )
        listbox.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.config(command=listbox.yview)

        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        for backup_file in backup_files:
            # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
            try:
                date_time = backup_file.replace('backup_', '').replace('.db', '')
                date_part = date_time[:8]
                time_part = date_time[9:]

                formatted_date = f"{date_part[:4]}-{date_part[4:6]}-{date_part[6:8]}"
                formatted_time = f"{time_part[:2]}:{time_part[2:4]}:{time_part[4:6]}"

                # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
                file_path = os.path.join(backup_dir, backup_file)
                file_size = os.path.getsize(file_path) / (1024 * 1024)

                display_text = f"{formatted_date} - {formatted_time} ({file_size:.2f} MB)"
            except:
                display_text = backup_file

            listbox.insert(tk.END, display_text)

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        buttons_frame = tk.Frame(browse_window, bg=self.COLORS["background"])
        buttons_frame.pack(fill=tk.X, pady=10)

        def restore_selected():
            selection = listbox.curselection()
            if not selection:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©")
                return

            selected_file = backup_files[selection[0]]
            backup_path = os.path.join(backup_dir, selected_file)

            if messagebox.askyesno(
                    "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©",
                    "Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n\n"
                    "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ",
                    icon="warning"
            ):
                import shutil
                import sys

                try:
                    # Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    self.db_conn.close()

                    # Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù…Ø¤Ù‚Øª Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    temp_backup = f"temp_{datetime.now().strftime('%Y%m%d_%H%M%S')}.db"
                    shutil.copy2("training_system.db", temp_backup)

                    # Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    shutil.copy2(backup_path, "training_system.db")

                    # Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
                    try:
                        os.remove(temp_backup)
                    except:
                        pass

                    messagebox.showinfo(
                        "Ù†Ø¬Ø§Ø­",
                        "ØªÙ…Øª Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­\n\n"
                        "Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬"
                    )

                    browse_window.destroy()

                    # Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                    python = sys.executable
                    os.execl(python, python, *sys.argv)

                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©:\n{str(e)}")
                    # Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
                    try:
                        self.db_conn = sqlite3.connect("training_system.db")
                    except:
                        pass

        # Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
        restore_btn = tk.Button(
            buttons_frame,
            text="Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
            font=("Tajawal", 14, "bold"),
            bg=self.COLORS["success"],
            fg="white",
            padx=30,
            pady=10,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=restore_selected
        )
        restore_btn.pack(side=tk.LEFT, padx=20)

        # Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        close_btn = tk.Button(
            buttons_frame,
            text="Ø¥ØºÙ„Ø§Ù‚",
            font=("Tajawal", 14, "bold"),
            bg=self.COLORS["dark"],
            fg="white",
            padx=30,
            pady=10,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=browse_window.destroy
        )
        close_btn.pack(side=tk.RIGHT, padx=20)

    def _cleanup_old_backups(self, backup_dir, keep_count=10):
        """Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯"""
        try:
            import os

            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            backup_files = []
            for file in os.listdir(backup_dir):
                if file.endswith('.db') and file.startswith('backup_'):
                    file_path = os.path.join(backup_dir, file)
                    backup_files.append((file_path, os.path.getmtime(file_path)))

            # ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            backup_files.sort(key=lambda x: x[1], reverse=True)

            # Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
            for file_path, _ in backup_files[keep_count:]:
                try:
                    os.remove(file_path)
                    # Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¥Ù† ÙˆØ¬Ø¯
                    info_path = file_path.replace('.db', '_info.txt')
                    if os.path.exists(info_path):
                        os.remove(info_path)
                except:
                    pass

        except Exception as e:
            print(f"Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©: {e}")

    def _reset_system(self):
        """Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        # ØªØ­Ø°ÙŠØ± Ø£ÙˆÙ„
        if not messagebox.askyesno(
                "ØªØ­Ø°ÙŠØ±",
                "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ\n\n"
                "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!",
                icon="warning"
        ):
            return

        # ØªØ­Ø°ÙŠØ± Ø«Ø§Ù†ÙŠ
        if not messagebox.askyesno(
                "ØªØ­Ø°ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ",
                "Ù‡Ø°Ø§ Ø¢Ø®Ø± ØªØ­Ø°ÙŠØ±!\n\n"
                "Ø³ÙŠØªÙ… Ø­Ø°Ù:\n"
                "â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†\n"
                "â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„\n"
                "â€¢ Ø¬Ù…ÙŠØ¹ Ù…Ø³Ù…ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª\n"
                "â€¢ Ø¬Ù…ÙŠØ¹ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³\n\n"
                "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ",
                icon="warning"
        ):
            return

        # Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© ØªØ£ÙƒÙŠØ¯
        confirm_dialog = tk.Toplevel(self)
        confirm_dialog.title("ØªØ£ÙƒÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†")
        confirm_dialog.geometry("400x200")
        confirm_dialog.configure(bg=self.COLORS["surface"])
        confirm_dialog.transient(self)
        confirm_dialog.grab_set()

        # ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©
        confirm_dialog.update_idletasks()
        x = (confirm_dialog.winfo_screenwidth() - 400) // 2
        y = (confirm_dialog.winfo_screenheight() - 200) // 2
        confirm_dialog.geometry(f"400x200+{x}+{y}")

        # Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        content = tk.Frame(confirm_dialog, bg=self.COLORS["surface"], padx=20, pady=20)
        content.pack(fill=tk.BOTH, expand=True)

        tk.Label(
            content,
            text="Ø§ÙƒØªØ¨ 'Ø­Ø°Ù Ø§Ù„ÙƒÙ„' Ù„Ù„ØªØ£ÙƒÙŠØ¯:",
            font=("Tajawal", 14, "bold"),
            bg=self.COLORS["surface"]
        ).pack(pady=(0, 10))

        confirm_entry = tk.Entry(
            content,
            font=("Tajawal", 14),
            width=30
        )
        confirm_entry.pack(pady=10)
        confirm_entry.focus()

        result = {"confirmed": False}

        def check_confirmation():
            if confirm_entry.get() == "Ø­Ø°Ù Ø§Ù„ÙƒÙ„":
                result["confirmed"] = True
                confirm_dialog.destroy()
            else:
                messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø©")
                confirm_entry.delete(0, tk.END)

        tk.Button(
            content,
            text="ØªØ£ÙƒÙŠØ¯",
            font=("Tajawal", 12, "bold"),
            bg=self.COLORS["danger"],
            fg="white",
            padx=20,
            pady=8,
            bd=0,
            relief=tk.FLAT,
            command=check_confirmation
        ).pack(pady=10)

        confirm_dialog.wait_window()

        if not result["confirmed"]:
            return

        # ØªÙ†ÙÙŠØ° Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        try:
            cursor = self.db_conn.cursor()

            # Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            tables_to_clear = [
                "teachers",
                "teacher_courses",
                "training_programs",
                "program_subjects",
                "program_schedule",
                "course_names",
                "course_teacher_paths"
            ]

            for table in tables_to_clear:
                cursor.execute(f"DELETE FROM {table}")

            # Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯Ø§Øª AUTO_INCREMENT
            for table in tables_to_clear:
                cursor.execute(f"DELETE FROM sqlite_sequence WHERE name='{table}'")

            self.db_conn.commit()

            messagebox.showinfo(
                "ØªÙ…",
                "ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­\n\n"
                "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ… Ø­Ø°ÙÙ‡Ø§"
            )

            # ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
            if hasattr(self, '_load_teachers'):
                self._load_teachers()
            if hasattr(self, '_load_training_programs'):
                self._load_training_programs()

        except Exception as e:
            self.db_conn.rollback()
            messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†:\n{str(e)}")

    def _create_database_tables(self):
        """Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        try:
            cursor = self.db_conn.cursor()

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS teachers (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    name TEXT NOT NULL,
                    rank TEXT,
                    id_number TEXT UNIQUE NOT NULL,
                    phone TEXT,
                    workplace TEXT,
                    qualification TEXT,
                    category TEXT,
                    created_date TEXT
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS teacher_courses (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    teacher_id INTEGER,
                    course_name TEXT,
                    course_date TEXT,
                    FOREIGN KEY (teacher_id) REFERENCES teachers(id) ON DELETE CASCADE
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS training_programs (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    program_number TEXT UNIQUE NOT NULL,
                    course_name_id INTEGER,
                    start_date TEXT,
                    end_date TEXT,
                    category TEXT,
                    created_date TEXT,
                    FOREIGN KEY (course_name_id) REFERENCES course_names(id),
                    UNIQUE(program_number)
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS program_subjects (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    program_id INTEGER,
                    subject_name TEXT NOT NULL,
                    subject_order INTEGER,
                    FOREIGN KEY (program_id) REFERENCES training_programs(id) ON DELETE CASCADE
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ù…Ø³Ù…ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS course_names (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    name TEXT UNIQUE NOT NULL,
                    description TEXT,
                    created_date TEXT,
                    is_active INTEGER DEFAULT 1
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø¯Ø±Ø³ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS course_teacher_paths (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    course_name TEXT NOT NULL,
                    teacher_id INTEGER NOT NULL,
                    is_responsible INTEGER DEFAULT 0,
                    created_date TEXT,
                    FOREIGN KEY (teacher_id) REFERENCES teachers(id) ON DELETE CASCADE,
                    UNIQUE(course_name, teacher_id)
                )
            """)

            # Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS program_schedule (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    program_id INTEGER NOT NULL,
                    week_number INTEGER NOT NULL DEFAULT 1,
                    day_of_week INTEGER NOT NULL,
                    period_number INTEGER NOT NULL,
                    start_time TEXT NOT NULL,
                    end_time TEXT NOT NULL,
                    subject_id INTEGER,
                    teacher_id INTEGER,
                    is_break INTEGER DEFAULT 0,
                    break_name TEXT,
                    location TEXT DEFAULT 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ',
                    is_special_week INTEGER DEFAULT 0,
                    special_week_name TEXT,
                    teacher_name TEXT,
                    FOREIGN KEY (program_id) REFERENCES training_programs(id) ON DELETE CASCADE,
                    FOREIGN KEY (subject_id) REFERENCES program_subjects(id) ON DELETE SET NULL,
                    FOREIGN KEY (teacher_id) REFERENCES teachers(id) ON DELETE SET NULL,
                    UNIQUE(program_id, week_number, day_of_week, period_number)
                )
            """)

            # Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­ØµØµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            cursor.execute("""
                CREATE TABLE IF NOT EXISTS default_periods (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    period_number INTEGER NOT NULL,
                    start_time TEXT NOT NULL,
                    end_time TEXT NOT NULL,
                    is_break INTEGER DEFAULT 0,
                    break_name TEXT
                )
            """)

            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙˆÙ‚Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            cursor.execute("SELECT COUNT(*) FROM default_periods")
            if cursor.fetchone()[0] == 0:
                # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                default_times = [
                    (1, "08:00", "08:45", 0, None),
                    (2, "09:15", "10:00", 0, None),
                    (3, "10:05", "10:50", 0, None),
                    (4, "10:55", "11:40", 0, None)
                ]

                for period in default_times:
                    cursor.execute("""
                        INSERT INTO default_periods (period_number, start_time, end_time, is_break, break_name)
                        VALUES (?, ?, ?, ?, ?)
                    """, period)

            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù…ÙˆØ¯ category ÙÙŠ Ø¬Ø¯ÙˆÙ„ teachers
            cursor.execute("PRAGMA table_info(teachers)")
            columns = [column[1] for column in cursor.fetchall()]

            if 'category' not in columns:
                cursor.execute("ALTER TABLE teachers ADD COLUMN category TEXT")

            self.db_conn.commit()

        except Exception as e:
            print(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: {str(e)}")

    def _open_user_management(self):
        """ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"""
        if not self.current_user["permissions"]["is_admin"]:
            messagebox.showerror("Ø®Ø·Ø£", "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†")
            return

        UserManagement(self, self.db_conn, self.current_user, self.COLORS, self.FONTS)


if __name__ == "__main__":
    root = tk.Tk()
    LoginSystem(root)
    root.mainloop()
